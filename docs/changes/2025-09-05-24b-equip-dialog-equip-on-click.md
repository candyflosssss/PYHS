# 变更：装备对话框点击即装备、保持开启、稀有度描边

- 日期：2025-09-05
- 影响范围：PyQt 装备 UI（`src/ui/pyqt/dialogs/equipment_dialog.py`、`src/ui/pyqt/widgets/card.py`）

## 修改摘要
- 修复此前对话框文件缩进/重复段落造成的语法错误，重写为干净版本。
- 对话框内点击背包物品立即执行 `inventory.use_item(...)`，窗口不关闭；“卸下”同样不关闭。
- 立即刷新：左侧槽位文本、右侧物品网格、父级角色卡片。
- 稀有度边框：物品按钮按稀有度着色边框，选中态边框更粗、略显底色。
- 角色卡 `_slot_click` 逻辑更新，避免对话框已装备后再次装备，改为仅在关闭后刷新。

## 影响范围
- 交互：装备流程更快（单击即生效）。
- 视觉：物品按钮有可见的稀有度描边与选中态。
- 稳定性：修复语法错误导致的 PyQt 界面无法加载问题。

## 风险与回滚
- 风险：
  - 即点即装可能与后续“确认”语义冲突（目前 OK 仅作为返回最近选择索引）。
  - 稀有度颜色硬编码在对话框内，后续可迁移至 `settings`。
- 回滚方法：
  - 使用 Git 回退本文件改动，或将 `EquipmentDialog._choose` 改回“仅记录，不立即装备”，并在 `CardWidget._slot_click` 中恢复关闭后再装备的逻辑。

## 相关文档/测试
- 文档：本条变更记录已添加。
- 测试：建议在 `scripts/qt_ui_smoke_test.py` 手动验证装备/卸下/双手武器占用逻辑与描边显示。
